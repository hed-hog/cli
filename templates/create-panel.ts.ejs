<% const toPascalCase = (str) => str.replace(/(^\w|[-_]\w)/g, (match) => match.replace(/[-_]/, '').toUpperCase()) %>;
<% const toCamelCase = (str) => str.replace(/_([a-z])/g, (_, char) => char.toUpperCase()); %>
<% const toKebabCase = (str) => str.replace(/_/g, '-'); %>

import FormPanel, { FormPanelRef, <%- hasLocale ? 'getFieldsLocale,' : '' %> } from '@/components/panels/form-panel'
<% if (fields.filter(field => field.name).length) { %>import { EnumFieldType } from '@/enums/EnumFieldType'<% } %>
import { use<%= toPascalCase(tableName) %>Create } from '@/features/<%= libraryName %>/<%= toKebabCase(tableName) %>'
import { <%= toPascalCase(tableName) %> } from '@/types/models'
import { forwardRef, useImperativeHandle, useRef } from 'react'
import { useTranslation } from 'react-i18next'

export type <%= toPascalCase(tableName) %>CreatePanelRef = {
    submit: () => void
}

export type <%= toPascalCase(tableName) %>CreatePanelProps = {
    onCreated?: (data: <%= toPascalCase(tableName) %>) => void
}

const <%= toPascalCase(tableName) %>CreatePanel = forwardRef(
    ({ onCreated }: <%= toPascalCase(tableName) %>CreatePanelProps, ref) => {
        const formRef = useRef<FormPanelRef>(null)
        const { t } = useTranslation(['actions'])
        const { mutateAsync: create<%= toPascalCase(tableName) %> } = use<%= toPascalCase(tableName) %>Create()

        useImperativeHandle(
            ref,
            () => ({
                submit: () => {
                formRef.current?.submit()
            },
        }),
        [formRef])

        return (
            <FormPanel
                ref={formRef}
                fields={[
                    <% fields.forEach((field, index, array) => { %>
                    {
                        name: '<%= field.name %>',
                        label: { text: t('<%= field.name %>', { ns: 'translation' }) },
                        type: EnumFieldType.TEXT,
                        required: true,
                    }<%= index < array.length - 1 || hasLocale ? ',' : '' %>
                    <% }) %>
                    <%- hasLocale ? '...getFieldsLocale([{ name: "name" }])' : '' %>
                ]}
                button={{ text: t('create', { ns: 'actions' }) }}
                onSubmit={async (data) => {
                    const createdData = await create<%= toPascalCase(tableName) %>(data)
                    if (typeof onCreated === 'function') {
                        onCreated(createdData)
                    }
                }}
            />
        )
    }
)

<%= toPascalCase(tableName) %>CreatePanel.displayName = '<%= toPascalCase(tableName) %>CreatePanel'

export default <%= toPascalCase(tableName) %>CreatePanel